{% extends "layouts/account-main.html" %}

{% block account_content %}


<script src="js/multi-polygon.js"></script>
<script src="js/addAuthor.js"></script>

<script>

function geoPolygon2() {
  var selected_geometry = document.getElementById("geometry").selectedIndex;
  console.log(selected_geometry);

  if (selected_geometry == 1) {
    // For Point
    document.getElementById('geo_bbox').innerHTML = `
    <div id="point1" class="child">
      <h4> Input point: </h4><br>
      <label for="bbox1">Latitude (Required):</label><br>
      <input type="text" id="lat1" name="lat1" class="input-textbox" value=""><br>
      <label for="bbox2">Longitude (Required):</label><br>
      <input type="text" id="lon1" name="lon1" class="input-textbox" value=""><br>
    </div>
    `;
    document.getElementById('add_button').innerHTML = `
    `;
  } else if ([2, 3, 5].includes(selected_geometry)) {
    // For MultiPoint, Polygon, LineString
    initializeDiv('geo_bbox');
    document.getElementById('geo_bbox').innerHTML = `
    <h4> Input points: </h4><br>
    <div id="point1" class="child">
      <label for="bbox1">Latitude (Required):</label><br>
      <input type="text" id="lat1" name="lat1" class="input-textbox" value=""><br>
      <label for="bbox2">Longitude (Required):</label><br>
      <input type="text" id="lon1" name="lon1" class="input-textbox" value=""><br>
    </div>
    `;
    document.getElementById('add_button').innerHTML = `
    <input type="button" class="input-textbox" value="Add Point" onclick="addPoint('geo_bbox');"/>
    `;
    document.getElementById('upload').innerHTML = `
      <h4> OR: GeoJSON bounding box </h4><br>
      <input type="text" id="myFile" name="myFile" class="input-textbox" value="">
    `;
  } else if ([4, 6, 7].includes(selected_geometry)) {
    // For MultiLineString, MultiPolygon, GeometryCollection
    document.getElementById('geo_bbox').innerHTML = ``;
    document.getElementById('add_button').innerHTML = ``;
    document.getElementById('upload').innerHTML = `
      <h4> GeoJSON bounding box </h4><br>
      <input type="text" id="myFile" name="myFile" class="input-textbox" value="">
    `;
  } else if (selected_geometry == 8) {
    // For Non-Spatial
    document.getElementById('geo_bbox').innerHTML = "No bounding box required";
  }
}

function addPoint(divElementID) {
    var pointDiv = document.getElementById(divElementID);
    var autindex = document.querySelectorAll("[id^=lat]").length + 1; // Count existing authors

    var div_box = document.createElement("div");
    div_box.classList.add("child");

    var label1 = document.createElement("label");
    label1.innerText = "Latitude:";
    label1.setAttribute("for", "lat" + autindex);

    var input1 = document.createElement("input");
    input1.setAttribute("type", "text");
    input1.setAttribute("id", "lat" + autindex);
    input1.setAttribute("name", "lat[]"); // Make it an array input
    input1.addEventListener("input", updateAuthorList); // Update list on input

    var label2 = document.createElement("label");
    label2.innerText = "Longitude:";
    label2.setAttribute("for", "lon" + autindex);

    var input2 = document.createElement("input");
    input2.setAttribute("type", "text");
    input2.setAttribute("id", "lon" + autindex);
    input2.setAttribute("name", "lon[]"); // Changed name to array input for last name

    div_box.appendChild(label1);
    div_box.appendChild(input1);
    div_box.appendChild(label2);
    div_box.appendChild(input2);

    pointDiv.appendChild(div_box);
}

function updateGeoList() {
    var listLat = [];
    var listLon = [];

    // Select all first name and last name inputs
    var inputs1 = document.querySelectorAll("[name='lat[]'], #lat1"); // First name inputs (including the initial one)
    var inputs2 = document.querySelectorAll("[name='lon[]'], #lon1"); // Last name inputs (including the initial one)

    inputs1.forEach(input => {
        if (input.value.trim() !== "") {
          listLat.push(input.value.trim()); // Add to first names list
        }
    });

    inputs2.forEach(input => {
        if (input.value.trim() !== "") {
          listLon.push(input.value.trim()); // Add to last names list
        }
    });

    // Store both first and last names as JSON strings
    document.getElementById("listLat").value = JSON.stringify(listLat);
    document.getElementById("listLon").value = JSON.stringify(listLon);
}

// Ensure the list is updated before submitting the form
document.getElementById("pointForm").addEventListener("submit", function() {
    updateGeoList();
})
</script>



<div id="intro">
<h1>Publish Files to Red Oak STAC Catalog</h1><br>
<p> This form allows you to publish datasets, data products and/or workflows to the Marble STAC catalog. Before filling out this form, ensure that the primary file is hosted on Red Oak in your public folder. Supplementary files such as input data can be included as third party links. After submission, a STAC item and citation will be generated and reviewed by admin before being uploaded to the catalog.</p>
<form id="pointForm" action="http://localhost:8000/submit" method="post"><br>
<label for="username" class="subtitle-1">Red Oak Username:</label><br>
    <input type="text" id="username" name="username" class="input-textbox" value="" required><br>
</div>

<div id="background">
	<h2> Background Information</h2><br>
    <label for="title">Title:</label><br>
    <input type="text" id="title" name="title" class="input-textbox" value="" required><br><br>
    <label for="desc" class="subtitle-1">Description:</label><br>
    <p><i>Include any additional details you want to provide about the STAC item. Similar to an abstract.</i></p>
    <input type="text" id="desc" name="desc" class="input-textbox" value=""><br><br>
</div>

<div class="author-group">
    <h2>Authors</h2><br>
    <p>Citation will list authors in order placed here. First author will be contacted by email regarding any issues in the submission.</p>
    <div id="author_box" class="parent">
    <!-- Initial author fields -->
        <div id="author1" class="child">
            <label for="fname1" class="subtitle-1">First Name*:</label><br>
            <input type="text" id="fname1" name="fname1" class="input-textbox" value="" required><br>
            <label for="lname1" class="subtitle-1">Last Name*:</label><br>
            <input type="text" id="lname1" name="lname1" class="input-textbox" value="" required><br>
            <label for="email1" class="subtitle-1">Email*:</label><br>
            <input type="text" id="email1" name="email1" class="input-textbox" value="" required><br>
        </div>
    </div>
    <div id="addAuthor">
        <input type="button" value="Add Author" class="input-textbox" onclick="addAuthor('author_box');"/>
    </div>
    <input type="hidden" id="authorFNames" name="authorFNames" class="input-textbox">
    <input type="hidden" id="authorLNames" name="authorLNames" class="input-textbox">
    <input type="hidden" id="authorEmails" name="authorEmails" class="input-textbox">
</div>

<div id="geometry_class">
    <h2> Geometry </h2><br>
    <p> Information on geometry types can be found here: <a href="https://datatracker.ietf.org/doc/html/rfc7946#section-3.1">RFC 7946, section 3.1</a> </p>
    <p> Longitudes should range from -180 to 180 and laitudes from -90 to 90.</p>
    <p> For complex geometries or sets of points longer than 4, we strongly recommend <a href="https://geojson.io/">generating a geoJSON bounding box using this tool</a> and pasting it into the box</p>
    <label for="geometry" class="subtitle-1">Choose the geometry type:</label>
    <div id="select" class="child">
    <select name="geometry" id="geometry" onchange="geoPolygon2();" onfocus="this.selectedIndex = -1;" required>
      <option value="blank">Select one</option>
      <option value="Point">Point</option>
      <option value="MultiPoint">Multi-Point</option>
      <option value="LineString">Line String</option>
      <option value="MultiLineString">Multi-Line String</option>
	    <option value="Polygon">Polygon</option>
      <option value="MultiPolygon">Multi-Polygon</option>
	    <option value="GeometryCollection">Geometry Collection</option>
      <option value="null">Null: Not-spatial file</option>
    </select>
    </div>
  <div id="geo_bbox" class="parent"></div>
  <div id="add_button"></div>
  <div id="upload"></div>
  </div>
  <input type="hidden" id="listLat" name="listLat" class="input-textbox">
  <input type="hidden" id="listLon" name="listLon" class="input-textbox">
</div>
  <div id=""metadata">
    <h2> Metadata </h2><br>
    <h4> Temporal Extent</h4>
    <label for="start_date" class="subtitle-1">Start Date:</label>
    <input type="datetime-local" id="start_date" name="start_date" class="input-textbox" value="" required>
    <label for="end_date" class="subtitle-1">End Date:</label>
    <input type="datetime-local" id="end_date" name="end_date" class="input-textbox" value="" required><br><br>
    <h4> Climatological Variables</h4>
    <p>Examples include temperature, pressure, and relative humidity as well as engineering variables such as cooling degree days. Adding additional variables as relevant is encouraged. Consult this link for standard variable names.</p>
    <label for="vars" class="subtitle-1">Add variables as comma separated list:</label>
    <input type="text" id="vars" name="vars" class="input-textbox" value=""><br><br>


    <h4> Models</h4>
    <p>List of relevant climate model data sources (eg CMIP6, EC3)</p>
    <input type="text" id="models" name="models" class="input-textbox" value=""><br>
  </div>
  <div id="files">
    <h2> Linked Files </h2><br>
    <label for="path" class="subtitle-1">Path to File (Primary file to be uploaded to STAC, should be in your public folder):</label><br>
    <input type="text" id="path" name="path" class="input-textbox" value="" required><br>
    <label for="input" class="subtitle-1">Link to inputs (Link to any input data used (can be RedOak or external link):</label><br>
    <input type="text" id="input" name="input" class="input-textbox" value=""><br>
    <label for="link" class="subtitle-1">Linked to any additional files (workflow files):</label><br>
    <input type="text" id="link" name="link" class="input-textbox" value=""><br>
  </div>
  <br>
  <div><input type="submit" class="button-med d-button-text" value="Submit Form"></div>
  <br>
</form>
<script>
  document.getElementById("pointForm").addEventListener("submit", function () {
      updateGeoList();
  });
  </script>



{% endblock %}